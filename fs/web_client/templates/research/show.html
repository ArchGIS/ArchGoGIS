<div class="content">
  <h2><%= t('research.singular') %> "<%= maybe(research, "Нет названия", "name") %>"</h2>
  <br>
  <dl>
    <dt><%= t('author.singular') %>:</dt>
    <dd><a href="#author/show/<%= author[0].id %>">
      <%= author[0].name %>
    </a></dd>
  </dl>

  <% if (coauthors.length) { %>
  <dl>
    <dt><%= t('coauthor.plural') %>:</dt>
    <% _.each(coauthors, function(a, i) { %>
      <dd><a href="#author/show/<%= a.id %>"><%= a.name %></a></dd>
    <% }); %>
  </dl>
  <% } %>
  
  <dl>
    <dt><%= t('research.year') %>:</dt>
    <dd><%= maybe(research, "Не указан", "year") %></dd>
  </dl>

  <dl>
    <dt><%= t('research.type') %>:</dt>
    <dd><%= maybe(resType, "Не указано", "name") %></dd>
  </dl>

  <dt><%= t('research.prop.description') %>:</dt>
  <dd><%= maybe(research, "Отсутствует", "description" ) %></dd>
  
  <dt><%= t('report.singular') %>:</dt>
  <dd>
    <% if (reports.length) { %>
      <div>
      <% _.each(reports, function(report, i) { %>
        <% var reportTitle = `${maybe(reports[i], "Нет названия", "name")} (${maybe(author[i], "автор неизвестен", "name")}, ${maybe(reports[i], "год не указан", "year")})` %>
        <% if (reports[i].fileid) { %>
          <%= App.models.Report.href(reports[i].fileid, reportTitle) %>
        <% } else {%>
          <%= reportTitle %>
        <% } %>
      <% }); %>
      </div>
    <% } else { %>
        Нет отчёта
    <% } %>
  </dd>

  <div id="accordion">
    <% var counter = 1 %>
    <% _.each(monuments, function(monument, i) { %>
      
      <h4 class="accordion-header">
        <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>
        <%= t('monument.singular') %> №<%= counter++ %>: <b><%= knowledges[i].monument_name %></b>
      </h4>
      
      <div class="accordion-content">
        <dl>
          <dt></dt>
          <dd>
            <a href="#monument/show/<%= monument.id %>">
            Перейти к памятнику
          </a>
          </dd>
          <dt>Название, данное исследователем:</dt>
          <dd><%= knowledges[i].monument_name %></dd>
          <dt>Эпоха:</dt>
          <dd><%= maybe(epochs[i], "Нет данных", "name") %></dd>
          <dt>Культурная принадлежность, определенная исследователем:</dt>
          <dd><%= maybe(cultures[i], "Нет данных", "name") %></dd>
          <dt>Найденные артефакты:</dt>
          <dd>
            <% if (artifacts[i] && artifacts[i].length > 0) { %>
              <% var length = artifacts[i].length %>
              <% _.each(artifacts[i], function(artifact, i) { %>
                <a href="#artifact/show/<%= artifact.id %>">
                  <%= artifact.name%>
                </a>
                <% if (i < length-1) { %>
                ,
              <% } %>
            <% }); %>
            <% } else { %>
              нет
            <% } %>
          </dd>

          <dt>Археологические вскрытия:</dt>
          <dd>
            <% if (excavations[i] && excavations[i].length > 0) { %>
              <% var length = excavations[i].length %>
              <% _.each(excavations[i], function(excavation, i) { %>
                <%= maybe(excavation, `без названия ${i}`, "name")%>
                <% if (excavation.area) { %>
                  (<%= excavation.area%> м²)
                <% } %>
                <% if (i < length-1) { %>
                ,
                <% } %>
              <% }); %>
            <% } else { %>
              нет
            <% } %>
          </dd>
        </dl>
      </div>

    <% }) %>
  </div>

  <% if (usedArtifacts.length > 0) { %>
    <dl>
      <dt>Упоминаемые артефакты:</dt>
      <dd>
        <% var length = usedArtifacts.length %>
        <% _.each(usedArtifacts, function(artifact, i) { %>
        <a href="#artifact/show/<%= artifact.id %>">
          <%= artifact.name %>
        </a>
        <% if (i < length-1) { %>
        ,
        <% } %>
        <% }); %>
      </dd>
    </dl>
  <% } %>

<div class="maps">
  <%= widget("Map", {"placemarks": placemarks}, "map") %>
</div>
</div>


